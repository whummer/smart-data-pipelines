<div class="col-lg-8" ng-controller="HistoryOverviewController" id="homeHistoryDiv">
	<div class="ibox float-e-margins">
		<div class="ibox-title">
			<!--<span class="fa fa-history"></span> --><h5>Data Usage History</h5>
			<span ng-click="removeWidget('history')" class="pull-right glyphicon glyphicon-remove"></span>
		</div>
		<div class="ibox-content">
			<div ui-grid="gridConfig" style="max-height: 200px"></div>
		</div>
	</div>
</div>

<script>

	var app = angular.module("app");
	app.controller('HistoryOverviewController', [
		'$scope', '$http', '$compile',
		function ($scope, $http, $compile) {

			AppController($scope, $http, $compile);

			$scope.gridConfig = {};
			$scope.dateFormat = "yyyy-MM-dd hh:mm:ss";

			var initHistoryTable = function () {
				var columnsConfig = [
					{
						label: "From Date", field: "fromDate", sortable: true,
						cellTemplate: "<div class='ui-grid-cell-contents'>{{row.entity.fromDate | date: 'yyyy-MM-dd hh:mm:ss'}}</div>"
					},
					{
						label: "To Date", field: "toDate", sortable: true,
						cellTemplate: "<div class='ui-grid-cell-contents'>{{row.entity.toDate | date:'yyyy-MM-dd hh:mm:ss'}}</div>"
					},
					//{label: "Month", field: "month"},
					{label: "Data Events", field: "updateEvents", sortable: true},
					{label: "API Service Calls", field: "apiCalls", sortable: true},
					{label: "Data Traffic", field: "dataTraffic", sortable: true}
				];

				$scope.gridConfig.columnDefs = columnsConfig;

			}

			var buildHistoryTable = function (history) {
				$scope.gridConfig.data = history;
			};

			var loadHistoryTable = function (history) {
				var opts = {};
				opts.type = "usage";
				opts.from = "";
				opts.to = "";
				opts.period = "month";
				riots.stats(opts, function (stats) {
					buildHistoryTable(stats.usage);
				});
			};

			/* init the main elements */
			initHistoryTable();
			loadHistoryTable();

		}
	]);

</script>
