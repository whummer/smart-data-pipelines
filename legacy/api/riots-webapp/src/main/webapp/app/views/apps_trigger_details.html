<section ng-controller="TriggerDetailsController">

  <div class="alert alert-warning alert-dismissible" role="alert">
    <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>
    <b><i>Riots Triggers</i></b> allow you to define rules for notifications that alert you about certain situations of interest, such as a vehicle leaving a virtual perimeter.
  </div>

  <div ng-show="shared.selectedTrigger">

    <form class="form-horizontal">

			<!-- ID -->
			<div class="form-group">
				<label for="triggerId" class="col-sm-3 control-label">ID</label>
				<div class="col-sm-9">
					<input id="triggerId" class="form-control input-sm" disabled="disabled"
								 ng-model="shared.selectedTrigger.id" />
				</div>
			</div>

      <!-- name -->
      <div class="form-group">
        <label for="triggerName" class="col-sm-3 control-label">Name</label>
        <div class="col-sm-9">
          <input id="triggerName" class="form-control input-sm" ng-model="shared.selectedTrigger.name" />
        </div>
      </div>

      <!-- created -->
      <div class="form-group">
        <label for="created" class="col-sm-3 control-label">Created</label>
        <div class="col-sm-9">
          <input id="created" class="form-control input-sm" type="text" disabled="disabled" value="{{formatTime(shared.selectedTrigger[CREATION_DATE])}}"/>
        </div>
      </div>

      <!-- type -->
      <div class="form-group">
        <label for="triggerType" class="col-sm-3 control-label">Trigger
          Type:</label>

        <div class="col-sm-9">
          <select id="triggerType" class="form-control input-sm" ng-model="shared.selectedTrigger.type">
            <option value="UNDEFINED"> -- Undefined --</option>
            <option value="GEO_FENCE">Geo Fence</option>
          </select>
        </div>
      </div>

      <!-- Geo Fence Details -->
      <div ng-show="shared.selectedTrigger.type == 'GEO_FENCE'">
        <div class="form-group">
          <label class="col-sm-3 control-label">Center (lat/lng):</label>
          <div class="col-sm-9">
            <table >
              <tr>
                <td>
                  <input class="form-control input-sm" ng-model="shared.selectedTrigger.center.latitude"/>
                </td>
                <td>
                  ,
                </td>
                <td>
                  <input  class="form-control input-sm" ng-model="shared.selectedTrigger.center.longitude"/>
                </td>
              </tr>
            </table>
          </div>
        </div>
      </div>

      <!-- save -->
      <div class="form-group">
        <label for="btnSaveTrigger" class="col-sm-3 control-label"></label>

        <div class="col-sm-9">
          <button class="pull-right btn btn-sm btn-primary input-sm" id="btnSaveTrigger"><span class="glyphicon glyphicon-ok"></span> Save</button>
        </div>
      </div>
    </form>

  </div>
</section>

<script type="text/javascript">
  var app = angular.module("app");
  app.controller('TriggerDetailsController', ['$scope', '$http', '$compile',
    function ($scope, $http, $compile) {

      AppController($scope, $http, $compile);

      var saveTrigger = function () {
        var item = clone($scope.shared.selectedTrigger);
        delete item["$$hashKey"];
        riots.save.trigger(item, function () {
          console.log("trigger saved");
        });
      }

      /* register event handlers */
      $scope.addClickHandler("btnSaveTrigger", saveTrigger);
    }
  ]);
</script>
