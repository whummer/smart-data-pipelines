<section ng-controller="CatalogViewController" id="devCatalogSection">
  <div class="container" ng-controller="ThingTypesController">
    <div class="panel panel-default">
      <div class="panel-heading">
        <h2 class="panel-title"><span class="glyphicon glyphicon-edit"></span> <b>{{shared.selectedThingType.name}}</b>
        </h2>
      </div>
      <div class="panel-body">
        <section ng-controller="ThingTypeController" id="devTypeSection">
          <tabset>
            <tab heading="Details">
              <ng-include src="appConfig['appRootPath'] + '/views/thing_type_details.html'"></ng-include>
            </tab>
            <tab heading="Composite Type">
              <ng-include src="appConfig['appRootPath'] + '/views/thing_type_composite.html'"></ng-include>
            </tab>
            <tab heading="Properties">
              <ng-include src="appConfig['appRootPath'] + '/views/thing_type_props.html'"></ng-include>
            </tab>
          </tabset>

          <div class="form-group" style="display: block; float: left; width: 100%;">

            <hr/>
            <div class="pull-left">
              <button class="btn  btn-sm btn-danger" id="btnDevTypeDelete">
                <span class="glyphicon glyphicon-remove"></span> Delete Thing
              </button>
            </div>
            <div class="pull-right">
              <button class="btn  btn-sm btn-primary" id="btnDevTypeSave">
                <span class="glyphicon glyphicon-ok"></span> Save Changes
              </button>
              <a href="#/catalog" class="btn btn-sm btn-info">
                <span class="glyphicon glyphicon-remove"></span> Cancel
              </a>
            </div>
          </div>

        </section>
      </div>
    </div>
  </div>
</section>

<script type="text/javascript">

  var app = angular.module("app");
  app.controller('ThingTypeController', function ($scope, $http, $compile, $routeParams, $log, $location) {
            AppController($scope, $http, $compile);

            $log.debug("Inside ThingTypeController with thingID: ", $routeParams.thingTypeID);

            if ($routeParams.thingTypeID) {
            	riots.thingType($routeParams.thingTypeID, function(thingType) {
                    $scope.shared.selectedThingType = thingType;
            	});
            }

            $scope.saveThingType = function () {
              var thingType = $scope.shared.selectedThingType;
              $scope.applyFeatures();
              $scope.prepareModelValues($scope.shared.selectedThingType);
              thingType = JSON.parse(JSON.stringify(thingType));
              thingType = $scope.prepareModelValues(thingType);
              riots.save.thingType(thingType, function() {
            	  $location.path("catalog");
              });
            };

            $scope.applyFeatures = function () {
              /* apply tags */
              $scope.shared.selectedThingType.tags = $("#devTypeTags").tagsinput('items');
              /* apply features */
              if (!$scope.shared.selectedThingType.features) {
                $scope.shared.selectedThingType.features = {};
              }
            };


            /* register event handlers */
            $scope.addClickHandler("btnDevTypeSave", $scope.saveThingType);
            $scope.addClickHandler("btnDevTypeDelete", $scope.deleteThingType);
          }
  );

</script>
