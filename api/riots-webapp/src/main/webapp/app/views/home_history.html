<section ng-controller="HistoryOverviewController" id="homeHistoryDiv">
    <div class="panel panel-default">
        <div class="panel-heading">
            <div class="panel-title"><span class="glyphicon glyphicon-fire"></span> <b>Data Usage History</b>
                <span ng-click="removeWidget('history')" class="pull-right glyphicon glyphicon-remove"></span></div>
        </div>
        <div class="panel-body">
            <div id="simHistoryTable" ui-grid="gridConfig" ui-grid-selection ui-grid-edit ui-grid-row-edit class="grid"></div>
        </div>
    </div>
</section>
<style>
	#simHistoryTable {
		height: 150px;
	}
</style>
<script>

    var app = angular.module("app");
    app.controller('HistoryOverviewController', [
        '$scope', '$http', '$compile',
        function ($scope, $http, $compile) {

            AppController($scope, $http, $compile);

            $scope.gridConfig = {};
            $scope.dateFormat = "yyyy-MM-dd hh:mm:ss";

            var initHistoryTable = function () {
            	var columnsConfig = [
                    {label: "From Date", field: "fromDate", sortable: true,
						cellTemplate: "<div class='ui-grid-cell-contents'>{{row.entity.fromDate | date: 'yyyy-MM-dd hh:mm:ss'}}</div>"
					},
                    {label: "To Date", field: "toDate", sortable: true,
						cellTemplate: "<div class='ui-grid-cell-contents'>{{row.entity.toDate | date:'yyyy-MM-dd hh:mm:ss'}}</div>"
					},
                    //{label: "Month", field: "month"},
                    {label: "Data Events", field: "updateEvents", sortable: true},
                    {label: "API Service Calls", field: "apiCalls", sortable: true},
                    {label: "Data Traffic", field: "dataTraffic", sortable: true}
                ];
                $scope.gridConfig.data = [];
                renderUITable($scope.gridConfig, "simHistoryTable", columnsConfig,
                        function (event) {
                            if (event.type == "dgrid-select") {
                                $scope.$apply(function () {
                                    $scope.selectedMonth = event.rows[0].data;
                                });
                            } else if (event.type == "dgrid-deselect") {
                                $scope.$apply(function () {
                                    $scope.selectedMonth = null;
                                });
                            }

                            /* adjust UI elements */
                            $("#btnDeviceTypePropsDelete").prop("disabled",
                                    $scope.selectedProperty == null);
                        }
                );
            }

            var buildHistoryTable = function (history) {
                $scope.gridConfig.data = history;
            };

            var loadHistoryTable = function (history) {
                invokeGET($scope.http, $scope.statsAPI + "/usage?from=&to=&period=month",
                    function (data, status, headers, config) {
                        buildHistoryTable(data.result.usage);
                    }
                );
            };

            /* init the main elements */
            initHistoryTable();
            loadHistoryTable();

        }
    ]);

</script>
