<section ng-controller="SimGraphsController" id="simGraphsSection" style="height: 100%">

	<div style="height: 100%; overflow: auto;" id="chartWrapper"
			ng-show="shared.selectedSim.simulation.type != 'GPS'">
		<canvas id="chart1" width="400" height="400"></canvas>
	</div>
	<div style="height: 300px;" id="mapWrapper"
			ng-show="shared.selectedSim.simulation.type == 'GPS'">
		<ng-include
					src="appConfig['appRootPath'] + '/views/map_view_simple.html'"></ng-include>
	</div>

</section>

<script>

var app = angular.module("app");
app.controller('SimGraphsController', [
	'$scope', '$http', '$compile',
	function($scope, $http, $compile) {

		AppController($scope, $http, $compile);

		$scope.renderGraph = function(data) {
			labels = [];
			datasets = [ {data: []} ];
			$.each(data.values, function(idx,val) {
				datasets[0].data.push(val.property.value);
				labels.push(val.time.time);
			});

			drawLineChart("chart1", datasets, labels);
			$("#chartWrapper").show();
		}

		/* register event handlers */
		$scope.subscribeOnce("update.chart.propSim", function(chartData) {
			$scope.renderGraph(chartData);
		}, "update.chart_propSim.graphsView");
		$scope.$watch("shared.selectedSimProp", function() {
			$("#chartWrapper").hide();
		});
		$scope.$watch("shared.selectedSim.simulation.type", function() {
			var sim = $scope.shared.selectedSim;
			if(sim && sim.simulation.type == 'GPS') {
				$scope.shared.map.render();
			}
		});
	}
]);

</script>
