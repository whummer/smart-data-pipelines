<html>
<head>
	<script type="text/javascript" src="/bower_components/jquery/dist/jquery.min.js"></script>
	<script type="text/javascript" src="scripts/build/r.js"></script>
	<script type="text/javascript" src="config.js"></script>
	<script type="text/javascript" src="config.requirejs.js"></script>
</head>
<body>
	<p>
	This may take a long time (up to several minutes), please be patient. Watch the console output for JS errors.
	</p>
	<div>
	<p>
	Concatenated Script:
	</p>
	<textarea id="output" style="width: 90%; height: 200px;">The result will appear here ...</textarea>
	</div>
	<div>
	<p>
	Build Output:
	</p>
	<textarea id="buildMessages" style="width: 90%; height: 200px;"></textarea>
	</div>

	<script>

	var cfg = JSON.parse(JSON.stringify(requirejsAppConfig));

    cfg.baseUrl = ".";
   	//cfg.name = "scripts/init.js";
   	delete cfg.name;
    cfg.out = "/app/scripts/riots-all.js";
    cfg.waitSeconds = 5;

	//"bg-splitter", // dont include here - leads to load error
	//"ui-codemirror", // dont include here - leads to load error

	// build config includes from requirejsAppConfig
	cfg.include = [];
	function addDependency(dep) {
		if($.inArray(dep, cfg.include) < 0) {
			cfg.include.push(dep);
		}
	}

	$.each(requirejsAppConfig.paths, function(idx,el) {
		addDependency(idx);
	});
	$.each(requirejsAppConfig.packages, function(idx,el) {
		if(el.main && !el.excludeFromOptimize) {
			addDependency(el.name);
		}
	});
	//addDependency("scripts/controllers/AppController");
	
	$.each(cfg.include, function(idx,el) {
		console.log("include dependency '" + el + "'");
	});

	cfg.findNestedDependencies = true;
	cfg.wrapShim = true;
	cfg.optimize = "none";
	cfg.optimize = "uglify2";
	cfg.uglify = cfg.uglify2 = {
		mangle : false
	}

	cfg.exclude = [
		//"angular"
	];

	cfg.out = function (text) {
		document.getElementById('output').value = text;
	}

	requirejs.optimize(cfg, function (buildText) {
		document.getElementById('buildMessages').value = buildText;
	}, function (error) {
		console.error("requirejs.optimize error", error);
	});

	</script>
</body>

</html>