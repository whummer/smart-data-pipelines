<html>
<head>
	<title>Stadtwerke Wien Dashboard</title>
	<link rel="stylesheet" href="/bower_components/leaflet/dist/leaflet.css">
	<link rel="stylesheet" href="/bower_components/ng-table/dist/ng-table.min.css">
	<link rel="stylesheet" href="/bower_components/bootstrap/dist/css/bootstrap.css">
	<script src="/bower_components/angular/angular.js"></script>
	<script src="/bower_components/leaflet/dist/leaflet.js"></script>
	<script src="/bower_components/angular-leaflet-directive/dist/angular-leaflet-directive.js"></script>
	<script src="/bower_components/ng-table/dist/ng-table.min.js"></script>
	<script src="/bower_components/jquery/dist/jquery.js"></script>
	<script src="/app/components/js/service-calls.js"></script>
	<script src="/bower_components/riox-shared/lib/api/riox-api.js"></script>
	<script src="../widgets/util/elasticsearch.js"></script>
	<script src="../widgets/mapLeaflet/index.js"></script>
	<script src="../widgets/table/index.js"></script>
	<style type="text/css">
		body {
			padding: 30px;
		}
	</style>

	<script type="text/javascript">
		angular.module("demoApp", ["riox-map-leaflet", "riox-table", "ngTable"]);
		var app = angular.module("demoApp");
		app.controller("DemoCtrl", function($scope) {
			$scope.esURL = "http://kibana." + window.location.hostname + "/elasticsearch/"; // TODO make configurable
			$scope.indexName = "smartcity"; // TODO make configurable
			$scope.typeName = "waitingtimes"; // TODO make configurable
			$scope.idFieldName = "shortName"; // TODO make configurable
			$scope.locFieldName = "location"; // TODO make configurable
			$scope.labelTemplate = "<table style=\"padding-left: 5px;\"><tr><td><b>K&uuml;rzel</b></td><td>{{shortName}}</td></tr>" +
					"<tr><td><b>Name</b></td><td>{{name}}</td></tr>" +
					"<tr><td><b>Warteschlange</b></td><td>{{waitingTime}}</td></tr></table>";

			$scope.insertData = function() {
				var req = {action: "insertData"};
				var url = "/demo";
				$("#btnInsert").prop("disabled", true);
				$("#btnInsert").html("Loading, please wait...");
				riox.callPOST(url, req, function(res) {
					window.location.reload();
				});
			};

		});
	</script>
</head>
<body>
	<div ng-app="demoApp" ng-view ng-controller="DemoCtrl">
		<div style="position: absolute; right: 0px; top: 0px;"><img src="smart_city_wien.png" style="height: 100px;"/></div>
		<h1>Wien Magistratsabteilungen - Dashboard</h1>
		<div class="panel panel-default">
			<button id="btnInsert" class="btn btn-small btn-primary" ng-click="insertData()">Create Test Pipes</button>
			<riox-map-leaflet height="400px" map-markers="map.markers" map-center="map.center"
				es-index-name="indexName" es-type-name="typeName" id-field="idFieldName" loc-field="locFieldName"
				label-template="labelTemplate" es-url="esURL"></riox-map-leaflet>
		</div>
		<div class="panel panel-default">
			<riox-table height="400px" map-markers="map.markers" map-center="map.center"
				es-index-name="indexName" es-type-name="typeName" id-field="idFieldName" loc-field="locFieldName"
				label-template="labelTemplate" es-url="esURL" 
				columns="{address:'Adresse', isOpen:'Ge&ouml;ffnet', name:'Name', shortName:'K&uuml;rzel', timestamp:'Zeit'}"></riox-table>

		</div>
	</div>
</body>
</html>